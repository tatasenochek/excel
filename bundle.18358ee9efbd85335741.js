(()=>{"use strict";var __webpack_modules__={863:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function parse(){let value=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(value.startsWith("="))try{return eval(value.slice(1))}catch(t){return value}return value}__webpack_require__.d(__webpack_exports__,{q:()=>parse})}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var s=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](s,s.exports,__webpack_require__),s.exports}__webpack_require__.d=(t,e)=>{for(var s in e)__webpack_require__.o(e,s)&&!__webpack_require__.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var __webpack_exports__={};(()=>{class t{constructor(t){this.$el="string"==typeof t?document.querySelector(t):t}html(t){return"string"==typeof t?(this.$el.innerHTML=t,this):this.$el.outerHTML.trim()}text(t){return void 0!==t?(this.$el.textContent=t,this):"input"===this.$el.tagName.toLowerCase()?this.$el.value.trim():this.$el.textContent.trim()}clear(){return this.html(""),this}on(t,e){this.$el.addEventListener(t,e)}off(t,e){this.$el.removeEventListener(t,e)}append(e){return e instanceof t&&(e=e.$el),Element.prototype.append?this.$el.append(e):this.$el.appendChild(e),this}closest(t){return e(this.$el.closest(t))}get data(){return this.$el.dataset}getCoords(){return this.$el.getBoundingClientRect()}findAll(t){return this.$el.querySelectorAll(t)}find(t){return e(this.$el.querySelector(t))}css(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.keys(t).forEach((e=>{this.$el.style[e]=t[e]}))}getStyles(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce(((t,e)=>(t[e]=this.$el.style[e],t)),{})}addClass(t){this.$el.classList.add(t)}removeClass(t){this.$el.classList.remove(t)}id(t){if(t){const t=this.id().split(":");return{row:+t[0],col:+t[1]}}return this.data.id}focus(){return this.$el.focus(),this}attr(t,e){return e?(this.$el.setAttribute(t,e),this):this.$el.getAttribute(t)}}function e(e){return new t(e)}e.create=function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=document.createElement(t);return s&&n.classList.add(s),e(n)};class s{static get path(){return window.location.hash.slice(1)}static get param(){return s.path.split("/")[1]}static navigate(t){window.location.hash=t}}class n{constructor(t){this.params=t}getRoot(){throw new Error('Method "getRoot" should be implemented')}afterRender(){}destroy(){}}const r={textAlign:"left",fontWeight:"normal",textDecoration:"none",fontStyle:"normal"},i="Новая таблица";var a=__webpack_require__(863);function o(t,e){return function(s,n){const i=m(t.colState,n),o=`${e}:${n}`,l=t.dataState[o],c=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(t).map((e=>{return`${s=e,s.replace(/([A-Z])/g,(t=>`-${t[0].toLowerCase()}`))}:${t[e]}`;var s})).join("; ")}({...r,...t.stylesState[o]});return`\n\t\t\t<div \n\t\t\t\tclass="cell" \n\t\t\t\tcontenteditable \n\t\t\t\tdata-type="cell" \n\t\t\t\tdata-col=${n} \n\t\t\t\tdata-row=${e}\n\t\t\t\tdata-id=${e}:${n}\n\t\t\t\tdata-value="${l||""}"\n\t\t\t\tstyle="${c}; width:${i}"\n\t\t\t>${(0,a.q)(l)||""}</div>\n\t\t`}}function l(t,e,s){const n=t?'<div class="row-resize" data-resize="row"></div>':"",r=function(t,e){return(t[e]||p)+"px"}(s,t);return`\n   <div \n\t \tclass="row" \n\t \tdata-type="resizable" \n\t\tdata-row="${t}"\n\t\tstyle="height: ${r}"\n\t\t>\n      <div class="row-info">\n\t\t\t\t${t||""}\n\t\t\t\t${n}\n\t\t\t\t</div>\n      <div class="row-data">${e}</div>\n    </div>\n  `}function c(t){let{col:e,index:s,width:n}=t;return`\n\t\t<div \n\t\t\tclass="column" \n\t\t\tdata-type="resizable" \n\t\t\tdata-col="${s}" \n\t\t\tstyle="width: ${n}"\n\t\t> \n\t\t\t${e}\n\t\t\t<div class="col-resize" data-resize="col"></div>\n\t\t</div>\n\t`}function u(t){return"string"!=typeof t?"":"on"+t.charAt(0).toUpperCase()+t.slice(1)}const h={A:65,Z:90},d=120,p=26;function f(t,e){return String.fromCharCode(h.A+e)}function m(t,e){return(t[e]||d)+"px"}function g(t,e){return t>e&&([e,t]=[t,e]),new Array(e-t+1).fill("").map(((e,s)=>t+s))}function b(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)return JSON.parse(localStorage.getItem(t));localStorage.setItem(t,JSON.stringify(e))}function _(t){const e=b(t);return`\n    <li>\n      <a href="#excel/${t.split(":")[1]}" class="item">\n        <h3>${e.title}</h3>\n        <data>\n        ${new Date(e.date).toLocaleDateString()} <br/>\n        ${new Date(e.date).toLocaleTimeString()}\n        </data>\n      </a>\n    </li>\n  `}function v(t){return"excel:"+t}const y="TABLE_RESIZE",w="CHANGE_TEXT",$="APPLY_STYLE",S="CHANGE_STYLE",x="CHANGE_TITLE",E="UPDATE_DATE";class A{constructor(){this.listners={}}emit(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),n=1;n<e;n++)s[n-1]=arguments[n];return!!Array.isArray(this.listners[t])&&(this.listners[t].forEach((t=>{t(...s)})),!0)}subscribe(t,e){return this.listners[t]=this.listners[t]||[],this.listners[t].push(e),()=>{this.listners[t]=this.listners[t].filter((t=>t!==e))}}}class T{constructor(t){this.store=t,this.sub=null,this.prevState={}}subscribeComponents(t){this.prevState=this.store.getState(),this.sub=this.store.subscribe((e=>{Object.keys(e).forEach((s=>{var n,r;n=this.prevState[s],r=e[s],("object"==typeof n&&"object"==typeof r?JSON.stringify(n)===JSON.stringify(r):n===r)||t.forEach((t=>{if(t.isWatching(s)){const n={[s]:e[s]};t.storeChanged(n)}}))})),this.prevState=this.store.getState()}))}unsubscribeFromStore(){this.sub.unsubscribe()}}class k{constructor(t){this.components=t.components||[],this.store=t.store,this.emitter=new A,this.subscriber=new T(this.store)}getRoot(){const t=e.create("div","excel"),s={emitter:this.emitter,store:this.store};return this.components=this.components.map((n=>{const r=e.create("div",n.className),i=new n(r,s);return r.html(i.toHTML()),t.append(r),i})),t}init(){this.store.dispatch({type:E}),this.subscriber.subscribeComponents(this.components),this.components.forEach((t=>t.init()))}destroy(){this.subscriber.unsubscribeFromStore(),this.components.forEach((t=>t.destroy()))}}class C{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!t)throw new Error("No root provided for Events!");this.$root=t,this.listners=e}addEventListener(){this.listners.forEach((t=>{const e=u(t);if(!this[e])throw new Error(`Method ${e} is not implemented in ${this.name||""} Component`);this[e]=this[e].bind(this),this.$root.on(t,this[e])}))}removeEventListener(){this.listners.forEach((t=>{const e=u(t);this.$root.off(t,this[e])}))}}class L extends C{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e.listners),this.name=e.name||"",this.emitter=e.emitter,this.subscribe=e.subscribe||[],this.store=e.store,this.unsubscribers=[],this.prepare()}prepare(){}toHTML(){return""}$emit(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),n=1;n<e;n++)s[n-1]=arguments[n];this.emitter.emit(t,...s)}$on(t,e){const s=this.emitter.subscribe(t,e);this.unsubscribers.push(s)}$dispatch(t){this.store.dispatch(t)}storeChanged(){}isWatching(t){return this.subscribe.includes(t)}init(){this.addEventListener()}destroy(){this.removeEventListener(),this.unsubscribers.forEach((t=>t()))}}class N extends L{static className="excel__formula";constructor(t,e){super(t,{name:"Formula",listners:["input","keydown"],subscribe:["currentText"],...e})}toHTML(){return'\n        <p class="info">fx</p>\n        <div id="formula" class="input" contenteditable spellcheck="false"></div>\n    '}init(){super.init(),this.$formula=this.$root.find("#formula"),this.$on("table:select",(t=>{this.$formula.text(t.data.value)}))}storeChanged(t){let{currentText:e}=t;this.$formula.text(e)}onInput(t){this.$emit("formula:input",e(t.target).text())}onKeydown(t){["Enter","Tab"].includes(t.key)&&(t.preventDefault(),this.$emit("formula:done"))}}class O extends L{static className="excel__header";constructor(t,e){super(t,{name:"Header",listners:["input","click"],...e})}toHTML(){return`\n    <input type="text" class="input" value="${this.store.getState().title||i}">\n\n        <div class="buttons">\n          <button data-button="delete" class="button">\n            <span class="material-symbols-outlined">\n              delete\n            </span>\n          </button>\n          <button data-button="exit" class="button">\n            <span class="material-symbols-outlined">\n              logout\n            </span>\n          </button>\n        </div>\n    `}onClick(t){const n=e(t.target);"delete"===n.data.button?confirm("Вы действительно хотите удалить таблицу?")&&(localStorage.removeItem("excel:"+s.param),s.navigate("")):"exit"===n.data.button&&s.navigate("")}onInput(t){const s=e(t.target);var n;this.$dispatch((n=s.text(),{type:x,data:n}))}}class H{static selected="selected";constructor(){this.group=[],this.current=null}select(t){this.clear(),this.group.push(t),this.current=t,t.focus().addClass(H.selected)}clear(){this.group.forEach((t=>t.removeClass(H.selected))),this.group=[]}selectGroup(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.clear(),this.group=t,this.group.forEach((t=>t.addClass(H.selected)))}applyStyle(t){this.group.forEach((e=>e.css(t)))}get selectCellIds(){return this.group.map((t=>t.id()))}}class R extends L{static className="excel__table";constructor(t,e){super(t,{name:"Table",listners:["mousedown","keydown","input"],...e})}toHTML(){return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=h.Z-h.A+1,n=[],r=new Array(s).fill("").map(f).map(function(t){return function(e,s){return{col:e,index:s,width:m(t.colState,s)}}}(e)).map(c).join("");n.push(l(null,r,{}));for(let r=0;r<t;r++){const t=new Array(s).fill("").map(o(e,r)).join("");n.push(l(r+1,t,e.rowState))}return n.join("")}(100,this.store.getState())}prepare(){this.selection=new H}init(){super.init(),this.selectCell(this.$root.find('[data-id="0:0"]')),this.$on("formula:input",(t=>{this.selection.current.attr("data-value",t).text((0,a.q)(t)),this.updateTextInStore(t)})),this.$on("formula:done",(()=>{this.selection.current.focus()})),this.$on("toolbar:applyStyle",(t=>{var e;this.selection.applyStyle(t),this.$dispatch((e={value:t,ids:this.selection.selectCellIds},{type:$,data:e}))}))}selectCell(t){this.selection.select(t),this.$emit("table:select",t);const e=t.getStyles(Object.keys(r));this.$dispatch({type:S,data:e})}async resizeTable(t){try{const s=await function(t,s){return new Promise((n=>{const r=e(t.target),i=r.closest('[data-type="resizable"]'),a=i.getCoords(),o=s.findAll(`[data-col="${i.data.col}"]`),l=r.data.resize,c="col"===l?"bottom":"right";let u;r.css({opacity:1,[c]:"-5000px"}),document.onmousemove=t=>{if("col"===l){const e=Math.floor(t.pageX-a.right);u=Math.floor(a.width+e),r.css({right:-e+"px"})}else{const e=Math.floor(t.pageY-a.bottom);u=Math.floor(a.height+e),r.css({bottom:-e+"px"})}},document.onmouseup=()=>{document.onmousemove=null,document.onmouseup=null,r.css({opacity:0,bottom:0,right:0}),"col"===l?(i.css({width:u+"px"}),o.forEach((t=>t.style.width=u+"px"))):i.css({height:u+"px"}),n({value:u,typeResize:l,id:"col"===l?i.data.col:i.data.row})}}))}(t,this.$root);this.$dispatch(function(t){return{type:y,data:t}}(s))}catch(t){console.warn("Resize error",t.message)}}onMousedown(t){if(function(t){return t.target.dataset.resize}(t))this.resizeTable(t);else if(function(t){return"cell"===t.target.dataset.type}(t)){const s=e(t.target);if(t.shiftKey){const t=function(t,e){const s=t.id(!0),n=e.id(!0),r=g(n.col,s.col),i=g(n.row,s.row);return r.reduce(((t,e)=>(i.forEach((s=>t.push(`${s}:${e}`))),t)),[])}(s,this.selection.current).map((t=>this.$root.find(`[data-id="${t}"]`)));this.selection.selectGroup(t)}else this.selectCell(s)}}onKeydown(t){const{key:e}=t;if(["Tab","Enter","ArrowLeft","ArrowUp","ArrowRight","ArrowDown"].includes(e)&&!t.shiftKey){t.preventDefault();const s=this.selection.current.id(!0),n=this.$root.find(function(t,e){let{row:s,col:n}=e;switch(t){case"Enter":case"ArrowDown":s++;break;case"Tab":case"ArrowRight":n++;break;case"ArrowLeft":n=n-1<0?0:n-1;break;case"ArrowUp":s=s-1<0?0:s-1}return`[data-id="${s}:${n}"]`}(e,s));this.selectCell(n)}}updateTextInStore(t){var e;this.$dispatch((e={id:this.selection.current.id(),value:t},{type:w,data:e}))}onInput(t){this.updateTextInStore(e(t.target).text())}}class D extends L{constructor(){super(...arguments)}get template(){return JSON.stringify(this.state,null,2)}initState(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.state={...t}}setState(t){this.state={...this.state,...t},this.$root.html(this.template)}}function q(t){return`\n    <div \n      data-value='${JSON.stringify(t.value)}' \n      data-type="button"\n      class="button ${t.active?"active":""}"\n    >\n      <span class="material-symbols-outlined">${t.icon}</span>\n    </div>\n `}class I extends D{static className="excel__toolbar";constructor(t,e){super(t,{name:"Toolbar",listners:["click"],subscribe:["currentStyles"],...e})}prepare(){this.initState(r)}get template(){return[{icon:"format_bold",active:"bold"===(t=this.state).fontWeight,value:{fontWeight:"bold"===t.fontWeight?"normal":"bold"}},{icon:"format_italic",active:"italic"===t.fontStyle,value:{fontStyle:"italic"===t.fontStyle?"normal":"italic"}},{icon:"format_underlined",active:"underline"===t.textDecoration,value:{textDecoration:"underline"===t.textDecoration?"none":"underline"}},{icon:"format_align_left",active:"left"===t.textAlign,value:{textAlign:"left"}},{icon:"format_align_center",active:"center"===t.textAlign,value:{textAlign:"center"}},{icon:"format_align_right",active:"right"===t.textAlign,value:{textAlign:"right"}}].map(q).join("");var t}toHTML(){return this.template}onClick(t){const s=e(t.target);if("button"===s.data.type){const t=JSON.parse(s.data.value);this.$emit("toolbar:applyStyle",t)}}storeChanged(t){this.setState(t.currentStyles)}}const M={title:i,rowState:{},colState:{},dataState:{},stylesState:{},currentText:"",currentStyles:r,date:(new Date).toJSON()};function j(t,e){let s,n;switch(e.type){case y:return s="col"===e.data.typeResize?"colState":"rowState",{...t,[s]:z(t,s,e)};case w:return s="dataState",{...t,currentText:e.data.value,dataState:z(t,s,e)};case S:return{...t,currentStyles:e.data};case $:return s="stylesState",n=t[s]||{},e.data.ids.forEach((t=>{n[t]={...n[t],...e.data.value}})),{...t,[s]:n,currentStyles:{...t.currentStyles,...e.data.value}};case x:return{...t,title:e.data};case E:return{...t,date:(new Date).toJSON()};default:return t}}function z(t,e,s){const n=t[e]||{};return n[s.data.id]=s.data.value,n}new class{constructor(t,s){if(!t)throw new Error("Selector is not provided in Router");this.$placeholder=e(t),this.routes=s,this.page=null,this.changePageHendler=this.changePageHendler.bind(this),this.init()}init(){window.addEventListener("hashchange",this.changePageHendler),this.changePageHendler()}changePageHendler(){this.page&&this.page.destroy(),this.$placeholder.clear();const t=s.path.includes("excel")?this.routes.excel:this.routes.dashboard;this.page=new t(s.param),this.$placeholder.append(this.page.getRoot()),this.page.afterRender()}destroy(){window.removeEventListener("hashchange",this.changePageHendler)}}("#app",{dashboard:class extends n{getRoot(){const t=Date.now().toString();return e.create("div","db").html(`\n      <div class="db__header">\n        <h1>Таблицы</h1>\n      </div>\n      <div class="db__new">\n        <div class="link">\n          <a href="#excel${t}">\n            <span class="material-symbols-outlined">\n              add_circle\n              </span>\n          </a>\n          <p>Новая таблица</p>\n        </div>\n      </div>\n\n      ${function(){const t=function(){const t=[];for(let e=0;e<localStorage.length;e++){const s=localStorage.key(e);s.includes("excel")&&t.push(s)}return t}();return t.length?`\n    <ul class="db__list">\n      <li>\n        <article class="item-header">\n          <h3>Название таблицы</h3>\n          <p>Дата создания</p>\n        </article>\n      </li>\n      ${t.map(_).join("")}\n    </ul>\n  `:'<p class="empty">Вы еще не создали ни одной таблицы</p>'}()}\n     `)}},excel:class extends n{getRoot(){const t=this.params?this.params:Date.now().toString(),e=function(t){let e=t({...arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}},{type:"__INIT__"}),s=[];return{subscribe:t=>(s.push(t),{unsubscribe(){s=s.filter((e=>e!==t))}}),dispatch(n){e=t(e,n),s.forEach((t=>t(e)))},getState:()=>JSON.parse(JSON.stringify(e))}}(j,(n=b(v(this.params)))?(t=>({...t,currentStyles:r,currentText:""}))(n):(i=M,JSON.parse(JSON.stringify(i)))),s=function(e,s){let n;return function(){for(var e=arguments.length,s=new Array(e),r=0;r<e;r++)s[r]=arguments[r];clearTimeout(n),n=setTimeout((()=>{clearTimeout(n),(e=>{b(v(t),e)})(...s)}),300)}}();var n,i;return e.subscribe(s),this.excel=new k({components:[O,I,N,R],store:e}),this.excel.getRoot()}afterRender(){this.excel.init()}destroy(){this.excel.destroy()}}})})()})();